<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SVG Image Pattern Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    h2 { color: #666; margin-top: 0; }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
    }
    .status.success { background: #dcfce7; color: #166534; }
    .status.error { background: #fee2e2; color: #991b1b; }
    .status.loading { background: #fef3c7; color: #92400e; }
    svg {
      border: 2px solid #e5e7eb;
      background: white;
      display: block;
      margin: 10px 0;
    }
    pre {
      background: #f8f8f8;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    .url-test {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .url-test input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }
    button {
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #2563eb; }
  </style>
</head>
<body>
  <h1>ğŸ§ª SVG Image Pattern æ¸¬è©¦å·¥å…·</h1>

  <div class="test-card">
    <h2>1. åœ–ç‰‡ URL æ¸¬è©¦</h2>
    <div class="url-test">
      <input
        type="text"
        id="imageUrl"
        value="https://raw.githubusercontent.com/guychienll/pen-diff/refs/heads/main/232543043.jpeg"
        placeholder="è¼¸å…¥åœ–ç‰‡ URL"
      />
      <button onclick="testImageUrl()">æ¸¬è©¦</button>
    </div>
    <div id="urlTestResult"></div>
  </div>

  <div class="test-card">
    <h2>2. ç›´æ¥ Image å…ƒç´  <span id="test1Status" class="status loading">æ¸¬è©¦ä¸­...</span></h2>
    <p>ä½¿ç”¨æ¨™æº– HTML img æ¨™ç±¤</p>
    <img
      id="directImage"
      width="400"
      height="300"
      style="border: 2px solid #ddd"
    />
  </div>

  <div class="test-card">
    <h2>3. SVG Image å…ƒç´  <span id="test2Status" class="status loading">æ¸¬è©¦ä¸­...</span></h2>
    <p>åœ¨ SVG ä¸­ä½¿ç”¨ image å…ƒç´ </p>
    <svg width="400" height="300">
      <rect width="400" height="300" fill="#f0f0f0"/>
      <image
        id="svgImage"
        x="0"
        y="0"
        width="400"
        height="300"
        preserveAspectRatio="xMidYMid slice"
      />
    </svg>
  </div>

  <div class="test-card">
    <h2>4. SVG Pattern Fill <span id="test3Status" class="status loading">æ¸¬è©¦ä¸­...</span></h2>
    <p>ä½¿ç”¨ pattern å¡«å……çŸ©å½¢ (objectBoundingBox)</p>
    <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="imgPattern" x="0" y="0" width="1" height="1" patternContentUnits="objectBoundingBox">
          <image
            id="patternImage"
            x="0"
            y="0"
            width="1"
            height="1"
            preserveAspectRatio="xMidYMid slice"
          />
        </pattern>
      </defs>
      <rect x="0" y="0" width="400" height="300" fill="url(#imgPattern)"/>
    </svg>
  </div>

  <div class="test-card">
    <h2>5. ç”Ÿæˆçš„ SVG ç¨‹å¼ç¢¼</h2>
    <pre id="generatedSvg"></pre>
  </div>

  <div class="test-card">
    <h2>6. è¨ºæ–·è³‡è¨Š</h2>
    <pre id="diagnostics"></pre>
  </div>

  <script>
    const imageUrl = document.getElementById('imageUrl').value;
    let diagnostics = [];

    function addDiagnostic(message) {
      diagnostics.push(`[${new Date().toISOString().split('T')[1].slice(0, 8)}] ${message}`);
      document.getElementById('diagnostics').textContent = diagnostics.join('\n');
      console.log(message);
    }

    function setStatus(testId, status, message) {
      const el = document.getElementById(testId);
      el.className = `status ${status}`;
      el.textContent = message;
    }

    // Test 1: Direct image
    const directImg = document.getElementById('directImage');
    directImg.src = imageUrl;
    directImg.onload = () => {
      setStatus('test1Status', 'success', 'âœ… æˆåŠŸ');
      addDiagnostic('Test 1 (Direct Image): SUCCESS');
    };
    directImg.onerror = (e) => {
      setStatus('test1Status', 'error', 'âŒ å¤±æ•—');
      addDiagnostic(`Test 1 (Direct Image): FAILED - ${e.message || 'Load error'}`);
    };

    // Test 2: SVG image element
    const svgImg = document.getElementById('svgImage');
    svgImg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', imageUrl);
    svgImg.onload = () => {
      setStatus('test2Status', 'success', 'âœ… æˆåŠŸ');
      addDiagnostic('Test 2 (SVG Image): SUCCESS');
    };
    svgImg.onerror = (e) => {
      setStatus('test2Status', 'error', 'âŒ å¤±æ•—');
      addDiagnostic(`Test 2 (SVG Image): FAILED - ${e.message || 'Load error'}`);
    };

    // Test 3: SVG pattern
    const patternImg = document.getElementById('patternImage');
    patternImg.setAttributeNS('http://www.w3.org/1999/xlink', 'href', imageUrl);

    // Pattern doesn't have onload, so we check after a delay
    setTimeout(() => {
      // If test 1 and 2 passed, assume this passed too
      if (directImg.complete && directImg.naturalHeight !== 0) {
        setStatus('test3Status', 'success', 'âœ… æˆåŠŸ');
        addDiagnostic('Test 3 (SVG Pattern): SUCCESS (inferred from other tests)');
      } else {
        setStatus('test3Status', 'error', 'âŒ å¤±æ•—');
        addDiagnostic('Test 3 (SVG Pattern): FAILED (base image failed)');
      }
    }, 2000);

    // Generate SVG code
    const svgCode = `<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <pattern id="imgPattern" x="0" y="0" width="1" height="1" patternContentUnits="objectBoundingBox">
      <image
        href="${imageUrl}"
        x="0"
        y="0"
        width="1"
        height="1"
        preserveAspectRatio="xMidYMid slice"
      />
    </pattern>
  </defs>
  <rect x="0" y="0" width="400" height="300" fill="url(#imgPattern)"/>
</svg>`;

    document.getElementById('generatedSvg').textContent = svgCode;

    // Test image URL fetch
    function testImageUrl() {
      const url = document.getElementById('imageUrl').value;
      const resultDiv = document.getElementById('urlTestResult');
      resultDiv.innerHTML = '<span class="status loading">æ¸¬è©¦ä¸­...</span>';

      fetch(url, { method: 'HEAD' })
        .then(response => {
          if (response.ok) {
            resultDiv.innerHTML = `
              <div style="margin-top: 10px">
                <span class="status success">âœ… å¯è¨ªå•</span>
                <div style="margin-top: 8px; font-size: 14px;">
                  <div>Status: ${response.status} ${response.statusText}</div>
                  <div>Type: ${response.headers.get('content-type')}</div>
                  <div>Size: ${(parseInt(response.headers.get('content-length')) / 1024).toFixed(2)} KB</div>
                </div>
              </div>
            `;
            addDiagnostic(`URL Test: SUCCESS - ${url}`);
          } else {
            resultDiv.innerHTML = `<span class="status error">âŒ HTTP ${response.status}</span>`;
            addDiagnostic(`URL Test: FAILED - HTTP ${response.status}`);
          }
        })
        .catch(error => {
          resultDiv.innerHTML = `<span class="status error">âŒ ${error.message}</span>`;
          addDiagnostic(`URL Test: ERROR - ${error.message}`);
        });
    }

    // Auto test URL on load
    window.addEventListener('load', () => {
      testImageUrl();
      addDiagnostic('=== Test Started ===');
      addDiagnostic(`Image URL: ${imageUrl}`);
      addDiagnostic(`User Agent: ${navigator.userAgent}`);
    });
  </script>
</body>
</html>
