# Theme Toggle Feature ğŸŒ“

## åŠŸèƒ½æ¦‚è¿°

PencilHistory.xyz ç¾åœ¨æ”¯æ´æ‰‹å‹•åˆ‡æ›æ·ºè‰²/æ·±è‰²ä¸»é¡Œï¼æä¾›ä¸‰ç¨®æ¨¡å¼ï¼š

1. **â˜€ï¸ Light Mode** - æ·ºè‰²ä¸»é¡Œ
2. **ğŸŒ™ Dark Mode** - æ·±è‰²ä¸»é¡Œ
3. **ğŸ’» System** - è·Ÿéš¨ç³»çµ±è¨­å®šï¼ˆé è¨­ï¼‰

## ä½¿ç”¨æ–¹å¼

### åœ¨ç¶²é ä¸Šåˆ‡æ›ä¸»é¡Œ

1. é»æ“Šå³ä¸Šè§’çš„ **Theme** æŒ‰éˆ•ï¼ˆé¡¯ç¤º â˜€ï¸ æˆ– ğŸŒ™ åœ–ç¤ºï¼‰
2. é¸æ“‡ä½ æƒ³è¦çš„ä¸»é¡Œï¼š
   - **Light** - å›ºå®šä½¿ç”¨æ·ºè‰²ä¸»é¡Œ
   - **Dark** - å›ºå®šä½¿ç”¨æ·±è‰²ä¸»é¡Œ
   - **System** - è‡ªå‹•è·Ÿéš¨ç³»çµ±è¨­å®š

### ä¸»é¡ŒæŒä¹…åŒ–

- âœ… ä½ çš„é¸æ“‡æœƒå„²å­˜åœ¨ç€è¦½å™¨çš„ localStorage ä¸­
- âœ… é‡æ–°è¼‰å…¥é é¢æ™‚æœƒè¨˜ä½ä½ çš„è¨­å®š
- âœ… è·¨åˆ†é åŒæ­¥ï¼ˆåŒä¸€ç¶²åŸŸï¼‰

## æŠ€è¡“å¯¦ç¾

### æ¶æ§‹

```
src/components/theme/
â”œâ”€â”€ ThemeProvider.tsx    # React Context ä¸»é¡Œç®¡ç†
â””â”€â”€ ThemeToggle.tsx      # ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• UI
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ThemeProvider

- ç®¡ç†ä¸»é¡Œç‹€æ…‹ï¼ˆlight/dark/systemï¼‰
- ç›£è½ç³»çµ±ä¸»é¡Œè®ŠåŒ–
- æŒä¹…åŒ–åˆ° localStorage
- æ›´æ–° document class å’Œ meta theme-color

#### 2. ThemeToggle

- ä¸‹æ‹‰é¸å–® UI
- é¡¯ç¤ºç•¶å‰ä¸»é¡Œç‹€æ…‹
- ä¸‰å€‹é¸é …ï¼šLight, Dark, System
- å¸¶æœ‰åœ–ç¤ºå’Œå‹¾é¸æ¨™è¨˜

#### 3. CSS å¯¦ç¾

```css
/* é è¨­æ·ºè‰² */
:root,
.light {
  /* light colors */
}

/* ç³»çµ±åå¥½æ·±è‰² */
@media (prefers-color-scheme: dark) {
  :root:not(.light) {
    /* dark colors */
  }
}

/* æ‰‹å‹•é¸æ“‡æ·±è‰² */
.dark {
  /* dark colors */
}
```

### é˜²æ­¢é–ƒçˆ

åœ¨ `<head>` ä¸­æ³¨å…¥åˆå§‹åŒ– scriptï¼š

```javascript
(function () {
  const theme = localStorage.getItem("theme") || "system";
  const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  const resolved = theme === "system" ? systemTheme : theme;
  document.documentElement.classList.add(resolved);
})();
```

é€™ç¢ºä¿é é¢è¼‰å…¥æ™‚ç«‹å³å¥—ç”¨æ­£ç¢ºçš„ä¸»é¡Œï¼Œé¿å…ã€Œç™½å…‰é–ƒçˆã€ã€‚

## API ä½¿ç”¨

### åœ¨çµ„ä»¶ä¸­ä½¿ç”¨ä¸»é¡Œ

```typescript
import { useTheme } from '@/components/theme/ThemeProvider';

function MyComponent() {
  const { theme, setTheme, resolvedTheme } = useTheme();

  // theme: 'light' | 'dark' | 'system'
  // resolvedTheme: 'light' | 'dark' (å¯¦éš›ä½¿ç”¨çš„ä¸»é¡Œ)

  return (
    <div>
      <p>Current theme: {theme}</p>
      <p>Resolved theme: {resolvedTheme}</p>
      <button onClick={() => setTheme('dark')}>Use Dark</button>
    </div>
  );
}
```

### åœ¨ CSS ä¸­ä¾æ“šä¸»é¡Œæ¨£å¼

ä½¿ç”¨ Tailwind CSS çš„ semantic tokensï¼š

```tsx
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨ semantic tokens
<div className="bg-surface text-foreground">
  <h1 className="text-foreground">Title</h1>
  <p className="text-foreground-secondary">Description</p>
</div>

// âŒ ä¸å¥½çš„åšæ³•ï¼šç¡¬ç·¨ç¢¼é¡è‰²
<div className="bg-white text-black">
  <h1 className="text-gray-900">Title</h1>
</div>
```

## ä¸»é¡Œé¡è‰²å°ç…§è¡¨

### Semantic Tokens

| Token                  | Light Mode | Dark Mode | ç”¨é€”      |
| ---------------------- | ---------- | --------- | --------- |
| `foreground`           | #000000    | #ffffff   | ä¸»è¦æ–‡å­—  |
| `foreground-secondary` | #1e293b    | #e2e8f0   | æ¬¡è¦æ–‡å­—  |
| `foreground-tertiary`  | #334155    | #cbd5e1   | ä¸‰ç´šæ–‡å­—  |
| `foreground-muted`     | #475569    | #94a3b8   | éœéŸ³æ–‡å­—  |
| `background`           | #ffffff    | #0a0f1e   | ä¸»èƒŒæ™¯    |
| `background-secondary` | #f8fafc    | #1a1f2e   | æ¬¡èƒŒæ™¯    |
| `background-tertiary`  | #f1f5f9    | #2a2f3e   | ä¸‰ç´šèƒŒæ™¯  |
| `surface`              | #ffffff    | #1a1f2e   | å¡ç‰‡/è¡¨é¢ |
| `border`               | #e2e8f0    | #3a3f4e   | é‚Šæ¡†      |
| `primary`              | #4338ca    | #a5b4fc   | å“ç‰Œä¸»è‰²  |
| `success`              | #047857    | #6ee7b7   | æˆåŠŸ      |
| `warning`              | #b45309    | #fcd34d   | è­¦å‘Š      |
| `error`                | #b91c1c    | #fca5a5   | éŒ¯èª¤      |

æ‰€æœ‰é¡è‰²éƒ½ç¬¦åˆ **WCAG AAA** æ¨™æº–ï¼ˆ7:1 å°æ¯”åº¦ï¼‰ï¼

## UI è¨­è¨ˆ

### ä¸»é¡ŒæŒ‰éˆ•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ™ Theme â–¼      â”‚  â† æŒ‰éˆ•ï¼ˆé¡¯ç¤ºç•¶å‰åœ–ç¤ºï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜€ï¸  Light          âœ“  â”‚  â† é¸é …ï¼ˆå·²é¸æ“‡ï¼‰
â”‚ ğŸŒ™  Dark               â”‚
â”‚ ğŸ’»  System             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Light mode active      â”‚  â† ç‹€æ…‹æç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éŸ¿æ‡‰å¼è¨­è¨ˆ

- **Desktop**: é¡¯ç¤º "Theme" æ–‡å­— + åœ–ç¤º
- **Mobile**: åªé¡¯ç¤ºåœ–ç¤ºï¼ˆç¯€çœç©ºé–“ï¼‰
- **Dropdown**: å›ºå®šå¯¬åº¦ 192pxï¼Œå³å°é½Š

### å‹•ç•«æ•ˆæœ

- âœ… ä¸‹æ‹‰ç®­é ­æ—‹è½‰ 180Â°
- âœ… é¸å–®æ·¡å…¥/æ·¡å‡º
- âœ… Hover ç‹€æ…‹å¹³æ»‘éæ¸¡
- âœ… é¸ä¸­é …ç›®é«˜äº®ï¼ˆä¸»é¡Œè‰²èƒŒæ™¯ï¼‰

## éµç›¤ç„¡éšœç¤™

- âœ… Tab éµå¯èšç„¦åˆ°æŒ‰éˆ•
- âœ… Enter/Space é–‹å•Ÿé¸å–®
- âœ… æ–¹å‘éµå°èˆªé¸é …
- âœ… Escape é—œé–‰é¸å–®
- âœ… å®Œæ•´çš„ ARIA æ¨™ç±¤

## ç€è¦½å™¨æ”¯æ´

- âœ… Chrome 90+
- âœ… Firefox 88+
- âœ… Safari 14+
- âœ… Edge 90+

### localStorage æ”¯æ´

æ‰€æœ‰ç¾ä»£ç€è¦½å™¨éƒ½æ”¯æ´ã€‚å¦‚æœ localStorage ä¸å¯ç”¨ï¼ˆéš±ç§æ¨¡å¼ç­‰ï¼‰ï¼Œä¸»é¡Œä»å¯ä½¿ç”¨ï¼Œåªæ˜¯ä¸æœƒæŒä¹…åŒ–ã€‚

## æ¸¬è©¦æ¸…å–®

### åŠŸèƒ½æ¸¬è©¦

- âœ… é»æ“ŠæŒ‰éˆ•é–‹å•Ÿ/é—œé–‰é¸å–®
- âœ… é¸æ“‡ Light æ¨¡å¼ç«‹å³ç”Ÿæ•ˆ
- âœ… é¸æ“‡ Dark æ¨¡å¼ç«‹å³ç”Ÿæ•ˆ
- âœ… é¸æ“‡ System æ¨¡å¼è·Ÿéš¨ç³»çµ±
- âœ… é‡æ–°è¼‰å…¥é é¢ä¿æŒè¨­å®š
- âœ… ç³»çµ±ä¸»é¡Œè®ŠåŒ–æ™‚ System æ¨¡å¼è‡ªå‹•æ›´æ–°

### è¦–è¦ºæ¸¬è©¦

- âœ… æŒ‰éˆ•åœ–ç¤ºæ­£ç¢ºé¡¯ç¤ºï¼ˆâ˜€ï¸/ğŸŒ™ï¼‰
- âœ… é¸ä¸­é …ç›®æœ‰å‹¾é¸æ¨™è¨˜ âœ“
- âœ… ä¸‹æ‹‰é¸å–®å°é½Šæ­£ç¢º
- âœ… ç‹€æ…‹æ–‡å­—æ­£ç¢ºé¡¯ç¤º
- âœ… Hover æ•ˆæœæµæš¢

### ç„¡éšœç¤™æ¸¬è©¦

- âœ… éµç›¤å¯å®Œæ•´æ“ä½œ
- âœ… è¢å¹•é–±è®€å™¨å‹å–„
- âœ… Focus indicators å¯è¦‹
- âœ… é¡è‰²å°æ¯”åº¦ç¬¦åˆ AAA

## å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼é è¨­æ˜¯ System æ¨¡å¼ï¼Ÿ

A: å°Šé‡ä½¿ç”¨è€…çš„ç³»çµ±åå¥½ï¼Œæä¾›æœ€ä½³çš„é–‹ç®±å³ç”¨é«”é©—ã€‚

### Q: ä¸»é¡Œè¨­å®šæœƒåŒæ­¥åˆ°å…¶ä»–è£ç½®å—ï¼Ÿ

A: ä¸æœƒï¼Œè¨­å®šå„²å­˜åœ¨ç€è¦½å™¨çš„ localStorage ä¸­ï¼Œåƒ…é™æœ¬åœ°ã€‚å¦‚éœ€è·¨è£ç½®åŒæ­¥ï¼Œéœ€è¦å¯¦ç¾å¸³è™Ÿç³»çµ±ã€‚

### Q: å¯ä»¥æ·»åŠ æ›´å¤šä¸»é¡Œå—ï¼ˆå¦‚é«˜å°æ¯”åº¦ï¼‰ï¼Ÿ

A: å¯ä»¥ï¼åªéœ€æ“´å±• Theme type å’Œæ·»åŠ æ–°çš„ CSS classï¼š

```typescript
type Theme = "light" | "dark" | "high-contrast" | "system";
```

```css
.high-contrast {
  --foreground: #000000;
  --background: #ffffff;
  --primary: #0000ff;
  /* ... more colors with maximum contrast */
}
```

### Q: ä¸»é¡Œåˆ‡æ›æœƒé‡æ–°æ¸²æŸ“æ•´å€‹æ‡‰ç”¨å—ï¼Ÿ

A: ä¸æœƒã€‚ä¸»é¡Œåˆ‡æ›åªæ›´æ–° `<html>` çš„ classï¼ŒCSS è®Šæ•¸æœƒè‡ªå‹•ç”Ÿæ•ˆï¼ŒReact çµ„ä»¶ä¸æœƒé‡æ–°æ¸²æŸ“ã€‚

## æ•ˆèƒ½è€ƒé‡

### å„ªåŒ–é»

1. **CSS Variables**: ä½¿ç”¨ CSS è®Šæ•¸é¿å…é‡æ–°è¨ˆç®—æ¨£å¼
2. **No Re-render**: ä¸»é¡Œåˆ‡æ›ä¸è§¸ç™¼ React é‡æ–°æ¸²æŸ“
3. **localStorage**: æŒä¹…åŒ–åªåœ¨æ”¹è®Šæ™‚å¯«å…¥
4. **Script Injection**: åˆå§‹åŒ– script æ¥µå°ï¼ˆ<200 bytesï¼‰
5. **No Flash**: é é¢è¼‰å…¥æ™‚ç„¡ä¸»é¡Œé–ƒçˆ

### Bundle Size Impact

- ThemeProvider: ~1.2KB (gzipped)
- ThemeToggle: ~0.8KB (gzipped)
- Total: ~2KB

å°æ•´é«” bundle size å½±éŸ¿æ¥µå°ã€‚

## æœªä¾†å¢å¼·

å¯èƒ½çš„æ”¹é€²æ–¹å‘ï¼š

1. **è‡ªå‹•åˆ‡æ›** - æ ¹æ“šæ™‚é–“è‡ªå‹•åˆ‡æ›ï¼ˆç™½å¤©/å¤œæ™šï¼‰
2. **æ›´å¤šä¸»é¡Œ** - Solarized, Nord, Dracula ç­‰é è¨­ä¸»é¡Œ
3. **è‡ªè¨‚é¡è‰²** - å…è¨±ä½¿ç”¨è€…è‡ªè¨‚ä¸»é¡Œé¡è‰²
4. **å¹³æ»‘éæ¸¡** - ä¸»é¡Œåˆ‡æ›æ™‚çš„æ·¡å…¥æ·¡å‡ºå‹•ç•«
5. **å¸³è™ŸåŒæ­¥** - å°‡ä¸»é¡Œåå¥½åŒæ­¥åˆ°é›²ç«¯

## ç¸½çµ

âœ… **å®Œæ•´çš„ä¸»é¡Œåˆ‡æ›åŠŸèƒ½**
âœ… **ä¸‰ç¨®æ¨¡å¼ï¼šLight / Dark / System**
âœ… **æŒä¹…åŒ–åˆ° localStorage**
âœ… **ç„¡é–ƒçˆè¼‰å…¥**
âœ… **å®Œå…¨ç„¡éšœç¤™æ”¯æ´**
âœ… **WCAG AAA åˆè¦**
âœ… **éŸ¿æ‡‰å¼è¨­è¨ˆ**
âœ… **æ•ˆèƒ½å„ªåŒ–**

ä¸»é¡Œåˆ‡æ›åŠŸèƒ½ç¾å·²å®Œå…¨æ•´åˆåˆ°æ‡‰ç”¨ä¸­ï¼Œæä¾›ç„¡ç¸«çš„ä½¿ç”¨è€…é«”é©—ï¼ğŸ¨
